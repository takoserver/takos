# 複数端末環境でのMLSグループ管理とルーム同期

複数の端末を同じアカウントで利用しながら、チャットルームを安全に同期するための基本方針をまとめます。

## 端末ごとの鍵管理

- 各端末は独立した鍵ペアを保持し、MLS
  グループではそれぞれが個別のメンバー（葉）として扱われます。
- 同一ユーザーの端末であることを示すために、各端末の鍵には同じクレデンシャルを付与します。
- 新しい端末を追加する際は既存メンバーから Welcome
  メッセージを受け取り、不要になった端末は Remove 提案でグループから除外します。

## チャットルーム一覧の同期

- サーバーのルーム一覧エンドポイントから参加中のグループ ID
  を取得し、どのルームが存在するかを同期します。
- ルームの名前やアイコンなどのメタデータは MLS の `GroupContext`
  拡張に保存し、端末はこれを読み取って表示します。

## 実装上の注意点

- 端末がオフライン中に他端末でルーム更新があった場合、復帰時に未反映の更新を取得できるよう差分同期を行います。
- 鍵のローテーションや端末の追加・削除が頻繁に行われる環境では、ACK
  などを用いて状態の整合性を確認し、長期オフライン端末を整理します。
- ルーム一覧のメタデータにはバージョン番号やハッシュを付与し、不整合を検知できるようにすると安全です。

このドキュメントは、複数端末でのルーム同期と鍵管理の基本方針をまとめたものです。
