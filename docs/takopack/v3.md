# ğŸ™ Takos æ‹¡å¼µæ©Ÿèƒ½ä»•æ§˜æ›¸ v3

> **ä»•æ§˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v3.0 (ãƒ‰ãƒ©ãƒ•ãƒˆ) **æœ€çµ‚æ›´æ–°**: 2025-06-11

## ğŸ¯ ç›®æ¬¡

1. [ç›®çš„](#ç›®çš„)
2. [ç”¨èª](#ç”¨èª)
3. [ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ](#ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ )
4. [manifest.json è©³ç´°ä»•æ§˜](#manifestjson-è©³ç´°ä»•æ§˜)
5. [åå‰ç©ºé–“ã¨è¡çªå›é¿](#åå‰ç©ºé–“ã¨è¡çªå›é¿)
6. [API ä»•æ§˜](./api.md)
7. [v2.1ã‹ã‚‰ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰](#v21ã‹ã‚‰ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰)
8. [Sandbox å®Ÿè¡Œç’°å¢ƒ](#sandbox-å®Ÿè¡Œç’°å¢ƒ)

---

## ç›®çš„

Takos ã‚’ VSCode ãƒ©ã‚¤ã‚¯ã«å®‰å…¨ã‹ã¤æŸ”è»Ÿã«æ‹¡å¼µã™ã‚‹ãŸã‚ã®å…±é€šä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚æ‹¡å¼µã¯
**server.js**ã€**client.js**ã€**index.html** ã® 3 ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Œçµã—ã€Deno
äº’æ›ç’°å¢ƒä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

---

## ç”¨èª

| ç”¨èª                  | èª¬æ˜                                                       |
| --------------------- | ---------------------------------------------------------- |
| Pack (.takopack)      | zip å½¢å¼ã®æ‹¡å¼µãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€‚ãƒˆãƒƒãƒ—ã« `takos/` ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒã¤ |
| Identifier            | `com.example.foo` ã®ã‚ˆã†ãªé€† FQDNã€‚`takos` ã¯äºˆç´„æ¸ˆã¿      |
| Permission            | `resource:action(:scope)` å½¢å¼ã®æ¨©é™æ–‡å­—åˆ—                 |
| ExtensionDependencies | ä»–æ‹¡å¼µã¸ã®ä¾å­˜å®šç¾©                                         |
| Exports               | å¤–éƒ¨å…¬é–‹ API ã®ä¸€è¦§                                        |

---

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ 

```
awesome-pack.takopack
â””â”€ takos/
   â”œâ”€ manifest.json  # å¿…é ˆ
   â”œâ”€ server.js      # ã‚µãƒ¼ãƒãƒ¼
   â”œâ”€ client.js      # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
   â””â”€ index.html     # UI
```

`server.js` ã¨ `client.js` ã¯ä¾å­˜ã®ãªã„å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚`index.html` ã¯ UI
ã‚’æä¾›ã—ã¾ã™ã€‚`/api/extensions/<id>/ui` ã§èª­ã¿è¾¼ã‚€ã¨ `client.js`
ã‚‚è‡ªå‹•ã§ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚

---

## manifest.json è©³ç´°ä»•æ§˜

`manifest.json` ã¯ [manifest.schema.json](./manifest.schema.json)
ã§æ¤œè¨¼ã§ãã¾ã™ã€‚ä¸»ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

```jsonc
{
  "name": "awesome-pack",
  "description": "æ‹¡å¼µæ©Ÿèƒ½ã®èª¬æ˜",
  "version": "1.2.0",
  "identifier": "com.example.awesome",
  "icon": "./icon.png",
  "apiVersion": "3.0",

  "extensionDependencies": [
    { "identifier": "com.example.lib", "version": "^1.0.0" }
  ],

  "exports": ["postMessage", "notifyClient"],

  "permissions": [
    "fetch:net",
    "activitypub:send",
    "activitypub:read",
    "activitypub:receive:hook",
    "activitypub:actor:read",
    "activitypub:actor:write",
    "plugin-actor:create",
    "plugin-actor:read",
    "plugin-actor:write",
    "plugin-actor:delete",
    "kv:read",
    "kv:write",
    "cdn:read",
    "cdn:write",
    "extensions:invoke",
    "extensions:export",
    // denoã®æ¨©é™ã¯ç‰¹æ¨©çš„ãªæ“ä½œã‚’åˆ¶é™ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™
    // åŸºæœ¬çš„ã«è¦æ±‚ã—ã¾ã›ã‚“ãŒã€å¿…è¦ãªå ´åˆã¯è¿½åŠ ã—ã¦ãã ã•ã„
    "deno:read",
    "deno:write",
    "deno:net",
    "deno:env",
    "deno:run",
    "deno:sys",
    "deno:ffi"
  ],

  "server": { "entry": "./server.js" },
  "client": {
    "entryUI": "./index.html",
    "entryBackground": "./client.js"
  },

  "activityPub": {
    "objects": ["Note", "Create", "Like"],
    "hook": "onReceive"
  }
}
```

---

## åå‰ç©ºé–“ã¨è¡çªå›é¿

- Identifier ã¯é€† FQDN å½¢å¼ã‚’æ¡ç”¨ã—è¡çªã‚’é¿ã‘ã¾ã™ã€‚
- KV ã¨ã‚¢ã‚»ãƒƒãƒˆã¯ `identifier` æ¯ã«åå‰ç©ºé–“åˆ†é›¢ã•ã‚Œã¾ã™ã€‚
  - KV: `${identifier}:${key}`
  - CDN: `${identifier}/${path}`
- åŒåé–¢æ•°ã‚’ export ã—ã¦ã‚‚è­˜åˆ¥å­ã”ã¨ã«ç‹¬ç«‹ã™ã‚‹ãŸã‚è¡çªã—ã¾ã›ã‚“ã€‚
- ä¾å­˜è§£æ±ºã¯ npm-semver æº–æ‹ ã§æœ€æ–°ç‰ˆå„ªå…ˆã€è­¦å‘Šã‚ã‚Šã€‚

---

è©³ã—ã„ API ä»•æ§˜ã¯ [api.md](./api.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
## v2.1ã‹ã‚‰ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰

1. æ¨©é™å®£è¨€ã‚’ `manifest.permissions` ã«é›†ç´„ã€‚
2. manifest ã‹ã‚‰ `eventDefinitions` ã‚’å‰Šé™¤ã—ã€`takos.events.onRequest()`
   ã§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²ã€‚
3. ActivityPub API ã¯ `activityPub()` ã«çµ±åˆã€‚
4. `extensionDependencies` ã¨ `exports` ã‚’åˆ©ç”¨ã—ã€`takos.extensions` API
   ã§ä»–æ‹¡å¼µã¨é€£æºã€‚

---

## Sandbox å®Ÿè¡Œç’°å¢ƒ

- ã™ã¹ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§åˆ†é›¢ã•ã‚Œã¾ã™ã€‚
- `activate()` ã®æˆ»ã‚Šå€¤ã¯ structuredClone æº–æ‹ ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã€‚
- å‘¼ã³å‡ºã—æ¨©é™ã¯ export å…ƒã®ç¯„å›²ã«é™å®šã•ã‚Œã€ä¾å­˜å¾ªç’°ã¯ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

---

